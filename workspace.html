<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>CodeKit Workspace</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
          margin: 0;
          font-family: Arial, sans-serif;
          background-color: #fdeef4;
          color: #B76E79;
          display: flex;
          flex-direction: column;
          min-height: 100vh;
        }
        header, nav, footer {
          background-color: #e75480;
          text-align: center;
          color: #fff;
        }
        header { padding: 30px; }
        nav { padding: 10px; }
        nav a {
          color: #fff;
          text-decoration: none;
          margin: 0 15px;
          font-size: 1.2em;
        }
        nav a:hover { color: #ffe6ed; }
        main {
          flex: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 30px;
          gap: 20px;
        }
        textarea {
          width: 80%;
          height: 200px;
          font-family: monospace;
          font-size: 1em;
          border: 2px solid #e75480;
          border-radius: 5px;
          padding: 10px;
        }
        button {
          padding: 12px 24px;
          font-size: 1em;
          border-radius: 5px;
          border: 2px solid #e75480;
          background-color: #e75480;
          color: #fff;
          cursor: pointer;
        }
        button:hover { background-color: #B76E79; }
        #output {
          background: #fff;
          border: 2px solid #e75480;
          border-radius: 5px;
          padding: 15px;
          width: 80%;
          min-height: 100px;
          font-family: monospace;
          white-space: pre-wrap;
        }
        .taskbar {
          display: flex;
          justify-content: center;
          gap: 20px;
          margin-top: 10px;
        }
        .taskbar a {
          padding: 10px 20px;
          border-radius: 5px;
          border: 2px solid #e75480;
          background-color: #e75480;
          color: #fff;
          text-decoration: none;
          font-weight: bold;
        }
        .taskbar a:hover { background-color: #B76E79; }
    </style>
</head>
<body>
<header><h1>The Coding Atelier</h1></header>
<nav>
    <a href="index.html">Home</a>
    <a href="activities.html">Activities</a>
</nav>
<main>
    <h2 id="activityTitle">Loading activity...</h2>
    <p id="instructions">Loading instructions...</p>

    <textarea id="editor" placeholder="Write your code here..."></textarea>
    <div>
        <button id="runCode">Run Code</button>
        <button id="saveCode">Save Progress</button>
    </div>
    <div id="output"></div>


</main>
<footer><p>&copy; 2025 The Coding Atelier</p></footer>

<!-- Load JS-Interpreter -->
<script src="libs/js-interpreter/lib/js-interpreter.js"></script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

     const firebaseConfig = {
    apiKey: "AIzaSyB6bWIy-y_N6k7F12BZQfDxni85qrIe-Lw",
    authDomain: "the-coding-atelier.firebaseapp.com",
    projectId: "the-coding-atelier",
    storageBucket: "the-coding-atelier.firebasestorage.app",
    messagingSenderId: "469308886574",
    appId: "1:469308886574:web:f70cc92a1cdc63916299bf",
    measurementId: "G-2974BEEE3T"
  };


    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const activities = {
      1: { title: "Activity 1: Print a Pattern", instructions: "Write a loop that prints a triangle of stars ⭐." },
      2: { title: "Activity 2: Number Guessing Game", instructions: "Make a number guessing game (1–10)." },
      3: { title: "Activity 3: Simple Calculator", instructions: "Build a calculator: add, subtract, multiply, divide." },
      4: { title: "Activity 4: Favorite Foods", instructions: "Loop through an array of your favorite foods and print each one." },
      5: { title: "Activity 5: Greeting Function", instructions: "Write a function that greets you by name." }
    };

    const params = new URLSearchParams(window.location.search);
    const activityNum = params.get("activity") || "1";
    const activity = activities[activityNum];

    document.getElementById("activityTitle").textContent = activity.title;
    document.getElementById("instructions").textContent = activity.instructions;

    function runCode() {
      document.getElementById("output").textContent = "";
      let buffer = "";
      const code = document.getElementById("editor").value;

      function init(interpreter, globalObject) {
        const printWrapper = function(text) { buffer += text + "\n"; };
        interpreter.setProperty(globalObject, 'print',
          interpreter.createNativeFunction(printWrapper));
      }

      try {
        const interpreter = new Interpreter(code, init);
        while (interpreter.run()) {}
        document.getElementById("output").textContent = buffer || "Code ran successfully.";
      } catch (err) {
        document.getElementById("output").textContent = "Error: " + err.message;
      }
    }

    async function saveProgress() {
      const user = auth.currentUser;
      if (!user) {
        document.getElementById("output").textContent = "Please sign in to save progress.";
        return;
      }
      const code = document.getElementById("editor").value;
      await setDoc(doc(db, "progress", user.uid), {
        ["activity" + activityNum]: { status: "in-progress", code: code },
        email: user.email
      }, { merge: true });
      document.getElementById("output").textContent = "Progress saved!";
    }

    document.getElementById("runCode").addEventListener("click", runCode);
    document.getElementById("saveCode").addEventListener("click", saveProgress);

    // Load saved code if available
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const snap = await getDoc(doc(db, "progress", user.uid));
        if (snap.exists()) {
          const data = snap.data();
          const activityData = data["activity" + activityNum];
          if (activityData) {
            document.getElementById("editor").value = activityData.code || "";
            document.getElementById("output").textContent = "Loaded saved progress.";
          }
        }
      }
    });
</script>
</body>
</html>
